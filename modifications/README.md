Tips, Tricks and Hardware Modifications
==========================================================================================

Building the 23cm transceiver kit will get you a working transceiver, but you want
more of course. So here are my notes on modifications we've done on some of the
transceivers.

The short list:
------------------------------------------------------------------------------------------

We had the following problems/defects when building the kit:
- The BF199 had a mirrored pinout. Some batches of BF199 transistors are incorrectly
  produced. If you insert these in the print it appears to be broken.
  [See below for the fix](#standard-12mhz-oscillator-will-not-start).
- If the MC3362 does not seem to work, check if the 80MHz oscillator (IC3) is functioning.
- The MAR8 in the receiver produces a lot of background noise. It is also a little prone
  to oscillation.
- Some kits have the Y17C VCO instead of the ALPS1679C. It is pin compatible, but the
  manufacturer has numbered its pins differently, so it is unclear how to mount this VCO.
  [See below how to mount this VCO](#how-to-mount-the-y17c-2094-vco)
- A few of the through-hole capacitors turned out to have low resistance to ground. This
  might be caused by the heat needed to solder them to the casing. These almost-shorts
  caused strange problems. At first it seemed that the rotary encoder was broken, but it
  turned out to be a through-hole capacitor. Later the LCD panel started showing incorrect
  characters. This also was caused by one of the through-hole capacitors.
- Output signal was 2MHz wide. Monitoring the CP (Charge Pump) pin of the PLL, we noticed
  that the PLL was violently trying to keep the VCO on the Tx frequency, causing 400mV spikes
  on the Vtune pin of the Y17C VCO. We suspect a lower input impedance on the Y17C causes
  this. If you have this problem, a 100nF capacitor paralel to C36 will solve it. Please
  check your modulation after this modification.
- When transmitting, the voltage over D3, the 5v6 zener, drops to less than 4 Volts. R37
  heats up to the point it is too hot to touch. Output power seems to slowly drop when
  the resistor gets warmer.
- Heat, mainly from the CLY5 and R37 causes the 12MHz Chrystal (X2) to drift a bit. The 
  12MHz is multiplied over 100 times. This also increases this drift 100 times. For a 
  stable output frequency, a TCXO is strongly recommended. (will be documented later)
- The 88.5 sub-audio is a rather loud 88.1Hz square wave, making it not so "sub" ;-).
  It is generated by the Atmega328, which is running on its internal oscillator. This
  makes the frequency inaccurate, and some repeaters will have trouble detecting your
  sub-audio tone. [See below for a fix](#improve-subaudio-greatly).
- The VCO produces quite some "hiss" in some cases. This seems to be caused by noise on
  the output of the 78L09 (IC10) which delivers power to the VCO (IC7). Additional
  stabilization is achieved by putting an emitter-follower close to IC7. [See below for
  more information](#stabilize-vco-power) on where and how to do that.
  
How to mount the Y17c 2094 VCO
------------------------------------------------------------------------------------------

In some kits, there is a [Y17c 2094 VCO](images/Y17c-2094-VCO.jpg) instead of the
ALPS1679C. The pin numbering on the Y17c is different which can be confusing. Here's how
to place the Y17c on the board:

![Y17c VCO orientation](images/Y17C-oriantation.jpg)
  
Standard 12MHz oscillator will not start
------------------------------------------------------------------------------------------

When building the kit straight out of the box, the 12MHz oscillator around X2 and T1 did
not work. At first it looked like the BF199 was defective. But closer inspection revealed
that this particular BF199 was from a 
[batch which has a reverse pinout](images/BF199-reverse-pining-ebay.png). We soldered the
BF199 back in place, but mirrored, and the oscillator started working. Here's proof of the
BF199 in action:

![BF199 reverse pining](images/BF199-reverse-pining.jpg)

Remove receiver audio rumbling
------------------------------------------------------------------------------------------

![C24 Receive Audio](images/receive-audio.png)

Even with a strong FM signal you'll notive a low rumble in the audio. This is the MC3362
detecting all audio frequencies. To stop the lower frequencies from reaching the speaker,
replace C24 with a 1nF capacitor.

Improve Subaudio (greatly)
------------------------------------------------------------------------------------------

When using sub-audio to active a repeater, people will notice a ver noticeable hum on 
your audio. We noticed that this hum is caused by a combination of factors:

1. The subaudio is generated as a square wave by the Atmega328 processor, slightly
   filtered, and added to the microphone signal before the microphone pre-amp. At this
   point, it contains quite a few harmonics.
2. The Atmega328 is running on its internal oscillator. This is not exact, and in our case
   we noticed it to be lower than it should be. This causes the 88.5 sub-audio menu setting
   to generate a 88.1 sub-audio tone.
3. Turning up your mic gain also turns up the sub-audio with it.

This can be fixed with a simple 3rd order low-pass filter, and injecting the resulting
sub-audio tone after the microphone amplifier, like so:

![sub-audio modification](images/subaudio-mod.png)

Remove R30 (2M2) and save it. Connect a 1k resistor to pin 17 of the Atmega using
one of the pads where R30 was sitting. Build the rest of the low-pass filter as in the
schematic above, and re-use the 2M2 resistor to connect the output to R16 at the side of C35.

In my transceiver, it looks like this:

![sub-audio modification photo](images/subaudio-mod-photo.jpg)

Power on the transceiver, select a sub-audio tone and connect an oscilloscope to the runner
of the potentiometer. When transmitting, adjust the output at the runner to 1.2 Vpp. It
should look like a square wave on your screen at that point.

When done correctly, this level should be enough to open any sub-audio repeater, but the
filtered tone will not be heard by the receiving party.

Stabilize VCO power
------------------------------------------------------------------------------------------

The 78L09 (IC10) is supposed to produce stable and noise-free power to the VCO (IC7), but
it's not always stable enough. When you hear a hiss in the audio of a strong signal,
the chances are that the 78L09 is producing more noise than the VCO likes. This can be
solved by trading a bit of voltage for a bit of stability with a BC547 emitter follower:

![vco power stabilization](images/VCO-VCC-stabilization.png)

The emitter should be mounted very close to the VCO to minimize pickup of noise. Cutting
the trace between C38 and C37 is the most practical way to mount it.



